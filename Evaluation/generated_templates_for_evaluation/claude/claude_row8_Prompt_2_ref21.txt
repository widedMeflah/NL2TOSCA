tosca_definitions_version: tosca_simple_yaml_1_0

imports:
  - indigo_custom_types: https://raw.githubusercontent.com/indigo-dc/tosca-types/master/custom_types.yaml

description: TOSCA template for deploying a Wine Cellar Management System

topology_template:
  inputs:
    admin_email:
      type: string
      description: Email address for the administrator
    admin_password:
      type: string
      description: Password for admin access
      required: true

  node_templates:
    wine_app_server:
      type: tosca.nodes.indigo.Compute
      capabilities:
        endpoint:
          properties:
            network_name: PUBLIC
            ports:
              http_port:
                protocol: tcp
                source: 80
        host:
          properties:
            num_cpus: 2
            mem_size: 4 GB
        os:
          properties:
            type: linux
            distribution: ubuntu
            version: 20.04

    wine_database:
      type: tosca.nodes.DBMS.MySQL
      properties:
        root_password: { get_input: admin_password }
        name: wine_cellar_db
      requirements:
        - host: wine_app_server

    wine_application:
      type: tosca.nodes.WebServer.Apache
      properties:
        document_root: /var/www/html
        server_name: wine-cellar
      requirements:
        - host: wine_app_server
        - database_endpoint: wine_database

  outputs:
    website_url:
      value: { concat: ['http://', get_attribute: [wine_app_server, public_address]] }
      description: URL to access the wine cellar application

    database_endpoint:
      value: { get_attribute: [wine_database, endpoint] }
      description: Database endpoint for the application