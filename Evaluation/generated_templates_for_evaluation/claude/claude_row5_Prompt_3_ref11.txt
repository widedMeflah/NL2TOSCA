tosca_definitions_version: alien_dsl_2_0_0

metadata:
  template_name: alien4cloud-deployment
  template_version: 1.0.0
  template_author: admin

description: Alien4Cloud deployment with ElasticSearch and testing components

imports:
  - tosca-normative-types:1.0.0-ALIEN20
  - alien-base-types:2.0.0

node_types:
  org.alien4cloud.nodes.Alien4Cloud:
    derived_from: tosca.nodes.SoftwareComponent
    properties:
      context_root:
        type: string
        default: "/"
      profiles:
        type: list
        entry_schema:
          type: string
        default: ["security-demo", "noApiDoc"]
    requirements:
      - host: tosca.nodes.Compute
      - java: org.alien4cloud.nodes.JDK

  org.alien4cloud.nodes.ElasticSearch:
    derived_from: tosca.nodes.SoftwareComponent
    properties:
      cluster_name:
        type: string
      node_name:
        type: string
    requirements:
      - host: tosca.nodes.Compute
      - java: org.alien4cloud.nodes.JDK

  org.alien4cloud.nodes.JDK:
    derived_from: tosca.nodes.SoftwareComponent
    properties:
      version:
        type: string
        default: "8"
      download_url:
        type: string
        required: true

  org.alien4cloud.nodes.ITTest:
    derived_from: tosca.nodes.SoftwareComponent
    properties:
      branch:
        type: string
        default: "develop"
      version:
        type: string
        default: "1.3.0-RC5"
      test_suite:
        type: string
        default: "RunCloudify3AmazonLongRunIT"

topology_template:
  node_templates:
    Compute_Frontend:
      type: tosca.nodes.Compute
      capabilities:
        endpoint:
          properties:
            protocol: tcp
            network_name: PRIVATE
            initiator: source

    Compute_ES1:
      type: tosca.nodes.Compute
      capabilities:
        endpoint:
          properties:
            protocol: tcp
            network_name: PRIVATE
            initiator: source

    Compute_ES2:
      type: tosca.nodes.Compute
      capabilities:
        endpoint:
          properties:
            protocol: tcp
            network_name: PRIVATE
            initiator: source

    JDK:
      type: org.alien4cloud.nodes.JDK
      properties:
        download_url: "https://download.oracle.com/otn-pub/java/jdk/8u291-b10/d7fc238d0cbf4b0dac67be84580cfb4b/jdk-8u291-linux-x64.tar.gz"

    Alien4Cloud:
      type: org.alien4cloud.nodes.Alien4Cloud
      requirements:
        - host: Compute_Frontend
        - java: JDK

    ElasticSearch1:
      type: org.alien4cloud.nodes.ElasticSearch
      properties:
        cluster_name: "a4c-cluster"
        node_name: "node1"
      requirements:
        - host: Compute_ES1
        - java: JDK

    ElasticSearch2:
      type: org.alien4cloud.nodes.ElasticSearch
      properties:
        cluster_name: "a4c-cluster"
        node_name: "node2"
      requirements:
        - host: Compute_ES2
        - java: JDK

    ITTest:
      type: org.alien4cloud.nodes.ITTest
      requirements:
        - host: Compute_Frontend