
tosca_definitions_version: tosca_simple_yaml_1_3

description: Basic topology for Alien4Cloud with a remote Elasticsearch node and JDK instances.

topology_template:
  node_templates:
    network:
      type: tosca.nodes.Network
      description: A network for connecting compute resources.

    a4c_server_compute:
      type: tosca.nodes.Compute
      properties:
        os_arch: x86_64
        os_type: linux
        os_distribution: ubuntu
        image: Ubuntu-18.04
        num_cpus: 2
        mem_size: 4 GB
      requirements:
        - network:
            node: network
            capability: tosca.capabilities.Network.Linkable
            relationship: tosca.relationships.Network.LinksTo

    es_server_compute:
      type: tosca.nodes.Compute
      properties:
        os_arch: x86_64
        os_type: linux
        os_distribution: ubuntu
        image: Ubuntu-18.04
        num_cpus: 2
        mem_size: 4 GB
      requirements:
        - network:
            node: network
            capability: tosca.capabilities.Network.Linkable
            relationship: tosca.relationships.Network.LinksTo

    jdk_for_a4c:
      type: alien4cloud.nodes.JavaJDK
      properties:
        component_version: 1.8
      requirements:
        - host: a4c_server_compute

    jdk_for_es:
      type: alien4cloud.nodes.JavaJDK
      properties:
        component_version: 1.8
      requirements:
        - host: es_server_compute

    alien4cloud_instance:
      type: alien4cloud.nodes.Alien4Cloud
      properties:
        component_version: 3.2.0
      requirements:
        - host: a4c_server_compute
        - depends_on_jdk:
            node: jdk_for_a4c
            relationship: tosca.relationships.DependsOn
        - es_connection:
            node: elasticsearch_node
            capability: tosca.capabilities.Endpoint.Admin
            relationship: tosca.relationships.ConnectsTo

    elasticsearch_node:
      type: alien4cloud.nodes.Elasticsearch
      properties:
        component_version: 7.10.0
      requirements:
        - host: es_server_compute
        - depends_on_jdk:
            node: jdk_for_es
            relationship: tosca.relationships.DependsOn
      capabilities:
        es_admin_endpoint:
          type: tosca.capabilities.Endpoint.Admin
          properties:
            port: 9200
            protocol: http
