tosca_definitions_version: alien_dsl_2_0_0

node_templates:
  private_network:
    type: tosca.nodes.Network
    properties:
      ip_version: 4
      cidr: 10.0.0.0/24

  alien4cloud_server:
    type: tosca.nodes.Compute
    properties:
      os_arch: x86_64
      os_type: linux
      os_distribution: ubuntu
      os_version: 20.04
      min_cpus: 2
      mem_size: 4 GB
    requirements:
      - network:
          node: private_network
          capability: tosca.capabilities.network.Linkable
          relationship: tosca.relationships.AttachesTo
    capabilities:
      scalable:
        properties:
          min_instances: 1
          max_instances: 1

  elasticsearch_server:
    type: tosca.nodes.Compute
    properties:
      os_arch: x86_64
      os_type: linux
      os_distribution: ubuntu
      os_version: 20.04
      min_cpus: 2
      mem_size: 8 GB
    requirements:
      - network:
          node: private_network
          capability: tosca.capabilities.network.Linkable
          relationship: tosca.relationships.AttachesTo
    capabilities:
      scalable:
        properties:
          min_instances: 1
          max_instances: 1

  jdk_for_alien4cloud:
    type: alien.nodes.JavaJDK
    requirements:
      - host: alien4cloud_server

  alien4cloud_application:
    type: alien.nodes.Alien4Cloud
    requirements:
      - host: alien4cloud_server
      - depends_on: jdk_for_alien4cloud
      - es_connection:
          node: elasticsearch_service
          capability: tosca.capabilities.Endpoint
          relationship: tosca.relationships.ConnectsTo

  jdk_for_elasticsearch:
    type: alien.nodes.JavaJDK
    requirements:
      - host: elasticsearch_server

  elasticsearch_service:
    type: alien.nodes.ElasticSearch
    requirements:
      - host: elasticsearch_server
      - depends_on: jdk_for_elasticsearch
    capabilities:
      es_endpoint:
        type: tosca.capabilities.Endpoint
        properties:
          protocol: tcp
          port: 9200
          secure: false
          initiator: source