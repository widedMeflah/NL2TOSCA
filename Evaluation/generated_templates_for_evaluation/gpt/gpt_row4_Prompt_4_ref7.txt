
tosca_definitions_version: tosca_simple_yaml_1_3

topology_template:
  inputs:
    mongo_port:
      type: integer
      description: Port for MongoDB server
      default: 27017
      constraints:
        - in_range: [20000, 30000]

  node_templates:
    my_linux_host:
      type: tosca.nodes.Compute
      capabilities:
        host:
          properties:
            num_cpus: 2
            disk_size: 10 GB
            mem_size: 4096 MB
        os:
          properties:
            type: linux
            distribution: ubuntu
            version: 20.04

    mongo_db:
      type: tosca.nodes.Database.MongoDB
      requirements:
        - host: my_linux_host
      properties:
        port: { get_input: mongo_port }

    mongo_tcp_endpoint:
      type: tosca.nodes.Endpoint.Port
      properties:
        protocol: tcp
        port: { get_input: mongo_port }
        network_name: private
      requirements:
        - host: my_linux_host
        - service: mongo_db

  outputs:
    mongo_endpoint_ip:
      description: IP Address of the MongoDB host compute instance
      value: { get_attribute: [ my_linux_host, private_address ] }

    mongo_endpoint_port:
      description: Port number on which MongoDB is exposed
      value: { get_property: [ mongo_db, port ] }
