tosca_definitions_version: tosca_simple_profile_for_nfv_1_0_0

description: A basic Apache server deployment on a compute node with custom workflows.

topology_template:

  node_templates:

    compute_node:
      type: tosca.nodes.nfv.Compute
      interfaces:
        Standard:
          create: tosca.interfaces.nodes.nfv.Compute.create
          delete: tosca.interfaces.nodes.nfv.Compute.delete

    apache_server:
      type: tosca.nodes.SoftwareComponent
      interfaces:
        Standard:
          create: 
            implementation: scripts/install_apache.sh
          delete: 
            implementation: scripts/uninstall_apache.sh
          start:
            implementation: scripts/start_apache.sh
          stop:
            implementation: scripts/stop_apache.sh
          restart:
            implementation: scripts/restart_apache.sh
      requirements:
        - host:
            node: compute_node

    curl_command:
      type: tosca.nodes.Root
      interfaces:
        Standard:
          configure:
            implementation: scripts/run_curl.sh
      relationships:
        - type: tosca.relationships.HostedOn
          target: apache_server

  workflows:
    start_apache:
      steps:
        - step1:
            name: Start Apache Server
            targets: [apache_server]
            operation: Standard.start

    stop_apache:
      steps:
        - step1:
            name: Stop Apache Server
            targets: [apache_server]
            operation: Standard.stop

    restart_apache:
      steps:
        - step1:
            name: Restart Apache Server
            targets: [apache_server]
            operation: Standard.restart

    test_apache:
      steps:
        - step1:
            name: Access Apache Welcome Page
            targets: [curl_command]
            operation: Standard.configure
