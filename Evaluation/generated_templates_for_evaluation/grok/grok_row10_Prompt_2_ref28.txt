tosca_definitions_version: tosca_simple_yaml_1_3

description: TOSCA template for deploying Elasticsearch on a virtual machine using INDIGO orchestrator

topology_template:
  inputs:
    elasticsearch_password:
      type: string
      description: Password for Elasticsearch user
      required: true
    kibana_password:
      type: string
      description: Password for Kibana system user
      required: true

  node_templates:
    elasticsearch_vm:
      type: tosca.nodes.Compute
      properties:
        num_cpus: { type: integer, constraints: [ { in_range: [2, 4] } ] }
        mem_size: { type: string, constraints: [ { in_range: ["4 GB", "8 GB"] } ] }
      capabilities:
        endpoint:
          properties:
            network_name: PUBLIC
            initiator: source
      requirements:
        - host:
            node: elasticsearch_app
            relationship: tosca.relationships.HostedOn

    elasticsearch_app:
      type: tosca.nodes.SoftwareComponent
      properties:
        component_version: "7.4.1"
      artifacts:
        elasticsearch_install:
          file: https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.4.1-linux-x86_64.tar.gz
          type: tosca.artifacts.File
      interfaces:
        Standard:
          configure:
            implementation: scripts/configure_elasticsearch.sh
            inputs:
              elasticsearch_password: { get_input: elasticsearch_password }
              kibana_password: { get_input: kibana_password }
              network_access: "0.0.0.0"
      requirements:
        - host: elasticsearch_vm

  outputs:
    vm_public_address:
      description: Public IP address of the virtual machine
      value: { get_attribute: [elasticsearch_vm, endpoint, ip_address] }
    vm_access_credentials:
      description: Access credentials for the virtual machine
      value: { get_attribute: [elasticsearch_vm, endpoint, credentials] }
    elasticsearch_endpoint:
      description: Endpoint for accessing Elasticsearch
      value: { concat: ["http://", { get_attribute: [elasticsearch_vm, endpoint, ip_address] }, ":9200"] }