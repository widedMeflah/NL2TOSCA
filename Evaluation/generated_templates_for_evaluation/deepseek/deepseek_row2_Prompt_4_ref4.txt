
tosca_definitions_version: tosca_simple_yaml_1_0

imports:
  - tosca_types:tosca
  - alien4cloud-types:alien4cloud

topology_template:
  description: Apache Server Deployment Topology
  node_templates:
    Compute:
      type: tosca.nodes.Compute
      properties:
        resource: Compute

    ApacheServer:
      type: tosca.nodes.Application
      properties:
        resource: Apache
      requirements:
        - host: Compute
      interfaces:
        Standard:
          workflows:
            start: apache_start
            stop: apache_stop
            restart: apache_restart
          operations:
            curl_test: curl_operation

  workflow_templates:
    apache_start:
      type: tosca.workflows.Workflow
      description: Start Apache Server
      steps:
        - run: |
            sudo systemctl start apache2

    apache_stop:
      type: tosca.workflows.Workflow
      description: Stop Apache Server
      steps:
        - run: |
            sudo systemctl stop apache2

    apache_restart:
      type: tosca.workflows.Workflow
      description: Restart Apache Server
      steps:
        - run: |
            sudo systemctl restart apache2

    curl_operation:
      type: tosca.workflows.Workflow
      description: Test Apache Server with curl
      steps:
        - run: |
            curl http://localhost
