
tosca_definitions_version: alien4cloud-1.3

topology_template:
  description: A sample Node.js application with MongoDB on Linux infrastructure
  node_templates:
    mongo_db:
      type: tosca.nodes.Compute
      properties:
        name: MongoDB Server
        os: linux
        networks:
          - network: private
          - network: public
      capabilities:
        endpoint:
          ports:
            mongo_port:
              type: tosca.capabilities.Network.Port
              properties:
                protocol: tcp
                port: 27017
                source:
                  node: mongo_db
                  capability: endpoint
                  endpoint: mongo_port
      artifacts:
        mongo_db:
          type: tosca.artifacts.Impl
          file: scripts/mongo_install.sh
          deploy_path: /tmp

    nodejs_app:
      type: tosca.nodes.Compute
      properties:
        name: Node.js Application
        os: linux
        networks:
          - network: private
          - network: public
      capabilities:
        endpoint:
          ports:
            node_port:
              type: tosca.capabilities.Network.Port
              properties:
                protocol: tcp
                port: ${input.node_port}
                source:
                  node: nodejs_app
                  capability: endpoint
                  endpoint: node_port
      requirements:
        - mongo_db:
            node: mongo_db
            relationship: tosca.relationships.Network
            properties:
              network: private
      artifacts:
        nodejs_app:
          type: tosca.artifacts.Impl
          file: scripts/nodejs_install.sh
          deploy_path: /tmp

  relationship_templates:
    tosca.relationships.Network:
      properties:
        network_name: private

  inputs:
    node_port:
      type: integer
      description: The port number for the Node.js application
      default: 3000

  outputs:
    app_url:
      description: URL where the Node.js application can be accessed
      value:
        get_attribute: [nodejs_app, endpoint, ports, node_port, ip_address]
        get_attribute: [nodejs_app, endpoint, ports, node_port, port]
