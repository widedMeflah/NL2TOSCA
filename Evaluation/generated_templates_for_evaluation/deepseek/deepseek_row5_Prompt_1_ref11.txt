tosca_definitions_version: alien4cloud-1.3

topology_template:
  description: TOSCA template for a system running a specific application with JDK, web interface, replicated storage, and testing component
  topology:
    node_templates:
      application_server:
        type: Compute
        properties:
          os: linux
          network_interfaces:
            - network: network
        capabilities:
          - jdk:
              type: JDK
              properties:
                jdk_url: https://example.com/jdk-11.0.15_linux-x64_bin.rpm
                install_dir: /usr/lib/jvm/java-11-openjdk

      web_application:
        type: WebApplication
        properties:
          context_root: /
          startup_arguments: --security.config=security.properties --documentation.enabled=true
        relationships:
          - type: HostedOn
            target: application_server

      storage_instance_1:
        type: Database
        properties:
          database_name: storage_db_1
          database_version: 1.0.0
        capabilities:
          - ReplicaSet:
              replica_count: 2
        relationships:
          - type: Endpoint
            target: storage_endpoint_1

      storage_instance_2:
        type: Database
        properties:
          database_name: storage_db_2
          database_version: 1.0.0
        relationships:
          - type: Endpoint
            target: storage_endpoint_2

      storage_endpoint_1:
        type: DatabaseEndpoint
        properties:
          port: 5432
          protocol: tcp

      storage_endpoint_2:
        type: DatabaseEndpoint
        properties:
          port: 5432
          protocol: tcp

      testing_component:
        type: TestComponent
        properties:
          test_branch: main
          plugin_version: 2.1.0
          test_suite: integration_tests
        relationships:
          - type: HostedOn
            target: test_server

      test_server:
        type: Compute
        properties:
          os: linux
          network_interfaces:
            - network: network

      network:
        type: Network
        properties:
          ip_version: IPv4
