tosca_definitions_version: tosca_simple_profile_for_yaml_1_0_0

imports:
  - indigo_types: https://indigo-dc.github.io/tosca-types/indigo_types.yaml

topology_template:
  template_name: Deep Learning Application Deployment
  template_version: 1.0.0
  description: TOSCA template for deploying a deep learning application using Docker, Marathon, and Mesos.

  node_templates:
    deep_learning_container:
      type: indigo.Docker.Container
      properties:
        image: deephdc/deep-oc-plant-classification-theano
        port_mappings:
          - containerPort: 5000
            protocol: tcp
            hostPort: 5000

    marathon_job:
      type: indigo.Marathon.Application
      properties:
        cmd: deepaas-run --listen-ip 0.0.0.0
        labels:
          HAPROXY_GROUP: external
        constraints: []
        mem: 1024
        cpu: 1
      requirements:
        - host: deep_learning_container

    haproxy_service:
      type: indigo.HAProxy.Service
      properties:
        name: deep_learning_load_balancer
        labels:
          HAPROXY_GROUP: external
        backend:
          type: Marathon
          service_name: deep_learning_container
          port: 5000
