tosca_definitions_version: alien4cloud-1.3

topology_template:
  description: MongoDB deployment on Ubuntu x86_64 compute resource

  node_templates:
    compute:
      type: tosca.nodes.Compute
      properties:
        os: Ubuntu
        architecture: x86_64

    mongodb:
      type: tosca.nodes.Database
      properties:
        database_engine: MongoDB
        version: 6.x
        port:
          default: 27017
          constraints:
            - valid_values: [8000, 65535]
      requirements:
        - host: compute
        - network: private_network

    private_network:
      type: tosca.nodes.Network
      properties:
        network_name: private

  relationship_templates:
    connects_to_compute:
      type: tosca.relationships.ConnectsTo
      properties:
        network: private_network
        ports:
          mongodb_port:
            protocol: tcp
            source: 27017
            target: ${mongodb.port}

  outputs:
    mongodb_ip:
      value: { get_property: [compute, private_address] }
    mongodb_port:
      value: { get_property: [mongodb, port] }
